@foreach (var item in CheckableInstruments) {
	<label for="instrument-@item.Instrument">
		@item.Instrument.GetDisplayName()
		<input type="checkbox" id="instrument-@item.Instrument" @onchange="(e) => OnCheckboxChange(item, e)"/>
	</label>
	<br />
}
<br />

@code {
	[Parameter, EditorRequired]
	public Instrument Instruments { get; set; }

	[Parameter]
	public EventCallback<Instrument> InstrumentsChanged { get; set; }

	List<CheckableInstrument> CheckableInstruments { get; set; } = new();

	protected override void OnInitialized()
	{
		foreach (Instrument value in Enum.GetValues(typeof(Instrument))) {
			CheckableInstruments.Add(new CheckableInstrument() { Instrument = value, IsSelected = (Instruments & value) != 0 });
		}
	}

	private async Task OnCheckboxChange(CheckableInstrument item, ChangeEventArgs e)
	{
		item.IsSelected = !item.IsSelected;
		Instruments = CheckableInstruments
			.Where(cb => cb.IsSelected)
			.Select(val => val.Instrument)
			.Aggregate((Instrument)0, (result, value) => result | value);
		await InstrumentsChanged.InvokeAsync(Instruments);
	}

	class CheckableInstrument
	{
		public Instrument Instrument;
		public bool IsSelected;
	}
}
